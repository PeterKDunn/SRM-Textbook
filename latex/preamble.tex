\usepackage{booktabs}
\usepackage{longtable}
\usepackage[bf,singlelinecheck=off]{caption}
\usepackage{siunitx} % Correct units formatting

\usepackage{Alegreya}
\usepackage[scale=.7]{sourcecodepro}

%\usepackage{times,pifont} % Nice fonts
\usepackage[x11names]{xcolor}
\usepackage{fancyhdr}

\usepackage{stackengine} % Stacking things on top of each other (used in table, in the selecting a test chapter)
\renewcommand\stacktype{L}
\def\stackalignment{l}


\usepackage{multicol}
\usepackage{tabularx} % For column specifications, using the kable_styling function  column_spec()
\usepackage{tabu} % For column specifications, using the kable_styling function  column_spec()
\usepackage{float} % Needed for some kableExtra stuff
\usepackage{mdframed}
\usepackage{enumitem} % To change the itemize spacing in exercises.
\usepackage{subfig} % For sub-figure captions
\usepackage[font={small,it}]{caption}
\usepackage{wrapfig} % For text-wrapping figures

\usepackage{array}
\usepackage{ragged2e}
\newcolumntype{P}[1]{>{\RaggedLeft\hspace{0pt}}p{#1}} % This allows right-aligned, fixed with cols


% FIGURE PLACEMENT: https://tex.stackexchange.com/questions/140568/how-to-set-default-positioning-of-figure-table-document-wide
\makeatletter
  \providecommand*\setfloatlocations[2]{\@namedef{fps@#1}{#2}}
\makeatother
\setfloatlocations{figure}{hbtp}
\setfloatlocations{table}{hbtp}


%\setmainfont[UprightFeatures={SmallCapsFont=AlegreyaSC-Regular}]{Alegreya}

\usepackage{framed,color}
\definecolor{shadecolor}{RGB}{245,245,245}
\definecolor{lightshadecolor}{RGB}{230, 230, 255}
\definecolor{textcolor}{RGB}{100,100,100}

%\definecolor{exampleExtraColor}{RGB}{209, 223, 250}
\definecolor{examplecolor}{RGB}{245, 245, 245}

\renewcommand{\textfraction}{0.05}
\renewcommand{\topfraction}{0.8}
\renewcommand{\bottomfraction}{0.8}
\renewcommand{\floatpagefraction}{0.75}

%\renewenvironment{quote}{\begin{VF}}{\end{VF}}
\renewenvironment{quote}%
  {\begin{kframe}}
  {\end{kframe}}

% Redo the  href  command
\usepackage{hyperref}
\let\oldhref\href
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}


\ifxetex
  \usepackage{letltxmacro}
  \setlength{\XeTeXLinkMargin}{1pt}
  \LetLtxMacro\SavedIncludeGraphics\includegraphics
  \def\includegraphics#1#{% #1 catches optional stuff (star/opt. arg.)
    \IncludeGraphicsAux{#1}%
  }%
  \newcommand*{\IncludeGraphicsAux}[2]{%
    \XeTeXLinkBox{%
      \SavedIncludeGraphics#1{#2}%
    }%
  }%
\fi

% Default figure width
\setkeys{Gin}{width=0.5\linewidth}


\makeatletter
\newenvironment{kframe}{%
\medskip{}
\setlength{\fboxsep}{.8em}
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
 \makeatother
 


\makeatletter
\@ifundefined{Shaded}{
}{\renewenvironment{Shaded}{\begin{kframe}}{\end{kframe}}}
\makeatother


% \newenvironment{rmdthinkHTML}{}{} % DO nothing
\newenvironment{rmdblock}[1]
  {\setlength{\itemindent}{10em}\begin{quote}\vspace{-1em}
  \begin{itemize}\setlength{\parskip}{2mm}
  \renewcommand{\labelitemi}{
    \raisebox{-.5\height}[0pt][0pt]{
      {\setkeys{Gin}{width=1.5em,keepaspectratio}\includegraphics{icons/#1}}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{kframe}
  \item
  }
  {
  \end{kframe}
  \end{itemize}\vspace{-0.75em}\end{quote}
  }
\newenvironment{rmdblockNoIcon}
  {\begin{quote}\vspace{-0.75em}
  \setlength{\parskip}{2mm}
  %\begin{kframe}
  }
  {%\end{kframe}
  \vspace{-0.05em}\end{quote}
  }
  


\usepackage{tcolorbox} % Provides  \newtcolorbox




%%% Objectives boxes
\definecolor{ObjColour}{RGB}{237, 237, 237}
\newtcolorbox{objectivescolourbox}{
  colback=ObjColour,
  colframe=ObjColour,
  coltext=black,
  boxsep=5pt,
  arc=4pt}

\newenvironment{objectivesBox}[1]
  {\small
  \begin{itemize}[leftmargin=.5in]
  \renewcommand{\labelitemi}{
    \raisebox{-.4\height}[0pt][0pt]{
      {\setkeys{Gin}{width=1.5em,keepaspectratio}
        \includegraphics{icons/#1}\qquad}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{objectivescolourbox}
  \item
  }
  {
  \end{objectivescolourbox}
  \end{itemize}
  }  
  
  

% Tip boxes
\definecolor{TipColour}{RGB}{220, 220, 220}
\newtcolorbox{tipcolourbox}{
  colback=TipColour,
  colframe=TipColour,
  coltext=black,
  boxsep=5pt,
  arc=4pt}

  
\newenvironment{tipBox}[1]
  {
  \begin{itemize}[leftmargin=.5in]
  \renewcommand{\labelitemi}{
    \raisebox{-.4\height}[0pt][0pt]{
      {\setkeys{Gin}{width=1.5em,keepaspectratio}
        \includegraphics{icons/#1}\qquad}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{tipcolourbox}
  \item
  }
  {
  \end{tipcolourbox}
  \end{itemize}
  }
  
  
% Important Box
\definecolor{ImportantColour}{RGB}{220, 220, 220}
\newtcolorbox{importantcolourbox}{
  colback=ImportantColour,
  colframe=ImportantColour,
  coltext=black,
  boxsep=5pt,
  arc=4pt}
\newenvironment{importantBox}[1]
  {
  \begin{itemize}[leftmargin=.5in]
  \renewcommand{\labelitemi}{
    \raisebox{-.4\height}[0pt][0pt]{
      {\setkeys{Gin}{width=1.5em,keepaspectratio}
        \includegraphics{icons/#1}\qquad}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{importantcolourbox}
  \item
  }
  {
  \end{importantcolourbox}
  \end{itemize}
  } 


% Software Box
\definecolor{SoftwareColour}{RGB}{220, 220, 220}
\newtcolorbox{softwarecolourbox}{
  colback=SoftwareColour,
  colframe=SoftwareColour,
  coltext=black,
  boxsep=5pt,
  arc=4pt}
\newenvironment{softwareBox}[1]
  {
  \begin{itemize}[leftmargin=.5in]
  \renewcommand{\labelitemi}{
    \raisebox{-.4\height}[0pt][0pt]{
      {\setkeys{Gin}{width=1.5em,keepaspectratio}
        \includegraphics{icons/#1}\qquad}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{softwarecolourbox}
  \item
  }
  {
  \end{softwarecolourbox}
  \end{itemize}
  } 






% Think Box
\definecolor{ThinkColour}{RGB}{247, 247, 247}
\newtcolorbox{thinkcolourbox}{
  colback=ThinkColour,
  colframe=ThinkColour,
  coltext=black,
  boxsep=5pt,
  arc=4pt}
\newenvironment{thinkBox}[1]
  {
  \begin{itemize}[leftmargin=.5in]
  \renewcommand{\labelitemi}{
    \raisebox{-.4\height}[0pt][0pt]{
      {\setkeys{Gin}{width=1.5em,keepaspectratio}
        \includegraphics{icons/#1}\qquad}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{thinkcolourbox}
  \item
  }
  {
  \end{thinkcolourbox}
  \end{itemize}
  } 

%%% End of chapter answer boxes
\definecolor{EOCAnswerColour}{RGB}{247, 247, 247}
\newtcolorbox{EOCanswercolourbox}{
  colback=EOCAnswerColour,
  colframe=EOCAnswerColour,
  coltext=black,
  boxsep=5pt,
  arc=4pt}
  
  \newenvironment{EOCanswerBox}[1]
  {\small
  \begin{itemize}[leftmargin=.5in]
  \renewcommand{\labelitemi}{
    \raisebox{-.4\height}[0pt][0pt]{
      {\setkeys{Gin}{width=1.5em,keepaspectratio}
        \includegraphics{icons/#1}\qquad}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{EOCanswercolourbox}
  \item
  }
  {
  \end{EOCanswercolourbox}
  \end{itemize}
  }  



% Pronounce Box
\definecolor{PronounceColour}{RGB}{220, 220, 220}
\newtcolorbox{pronouncecolourbox}{
  colback = PronounceColour,
  colframe = PronounceColour,
  coltext = black,
  boxsep = 5pt,
  arc = 4pt}
\newenvironment{pronounceBox}[1]
  {
  \begin{itemize}[leftmargin=.5in]
  \renewcommand{\labelitemi}{
    \raisebox{-.4\height}[0pt][0pt]{
      {\setkeys{Gin}{width=1.5em,keepaspectratio}
        \includegraphics{icons/#1}\qquad}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{pronouncecolourbox}
  \item
  }
  {
  \end{pronouncecolourbox}
  \end{itemize}
  } 




% Progress Box: Should be blank (i.e. nothing appears) for LaTeX as it is not dynamic
\AtBeginEnvironment{progressBox}{\begin{comment}}
\AtEndEnvironment{progressBox}{\end{comment}}
\definecolor{ProgressColour}{rgb}{0.996, 0.996, 0.797}
\newtcolorbox{progresscolourbox}{
  colback = ProgressColour,
  colframe = ProgressColour,
  coltext = black,
  boxsep = 5pt,
  arc = 4pt}
\newenvironment{progressBox}[1]
  {}
  {}



% Answer Box
\newenvironment{answer}
  {\null\vspace{-5mm}\small}
  {\null\vspace{-5mm}} %{\smallskip}

\newenvironment{rmdnote}
  {\begin{rmdblock}{iconmonstr-light-bulb-2-240}}
  {\end{rmdblock}}
  
% exampleExtra: Omit this is latex
\usepackage{comment}
\excludecomment{exampleExtra}
%\newenvironment{exampleExtra}{}{}
%  {\begin{rmdblock}{iconmonstr-idea-12-240}\small\textbf{Example.}}
%  {\begin{rmdblockNoIcon}\small\textbf{Extra example:}}
%  {\end{rmdblockNoIcon}}



\newenvironment{darkgraytext}{\color{textcolor}}{\ignorespacesafterend}
%\AtBeginEnvironment{rmdblockNoIcon}{\begin{comment}}
%\AtEndEnvironment{rmdblockNoIcon}{\end{comment}}

%\usepackage{amsthm}
%\newtheorem*{ExampleFold}{Example}


%%% TRY HIDING EXAMPLE FOLDS, EXAMPLE FOLDS: To save paper in printing...???



% Redfine some existing environments
% -QUOTE
\makeatletter
\renewenvironment{quote}
               {\list{}{\vspace{-0.5em}\begin{kframe}\small%
                        \itemindent    \listparindent
                        \rightmargin   \leftmargin
                        \parsep        \z@ \@plus\p@}%
                \item\relax}
               {\end{kframe}\endlist\vspace{-0.5em}}
\makeatother


% ORIGINAL:
%\newenvironment{fold}
%  {\begin{rmdblock}{iconmonstr-idea-12-240}\vspace{-1em}\begin{darkgraytext}\footnotesize \textbf{Answer:}}
%  {\end{darkgraytext}\end{rmdblock}}
\newenvironment{fold}
  {\vspace{-6pt}\begin{rmdblockNoIcon}\scriptsize \textbf{Answer:}}
  {\end{rmdblockNoIcon}}
  
% Change the  fold  environment to be disappeared
% Note: In the LaTeX code, it appears like this: \BeginKnitrBlock{fold}
%\usepackage{comment}
%\AtBeginEnvironment{fold}{\begin{comment}}
%\AtEndEnvironment{fold}{\end{comment}}

%\begin{shaded}}
%\AtEndEnvironment{fold}{\end{shaded}}

%%% IF ONLY THIS WORKED:
% \usepackage{comment}
% \includecomment{fold}


\usepackage{makeidx}
\makeindex

\usepackage{url}
\urlstyle{sf}
   

% NOTE:  clashes with  ntheorem  package... if I want to use that. I tried to use if to put lemma in shaded backgrounds... without luck. So I just put this code back.
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}

\makeatother

\frontmatter
