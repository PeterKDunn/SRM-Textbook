<!-- # (PART) Correlational RQs: correlation and regression {-} -->

# Correlation {#Correlation}



<!-- <!-- Introductions; easier to separate by format --> -->
<!-- ```{r, child = if (knitr::is_html_output()) {'./introductions/33-Correlation-HTML.Rmd'} else {'./introductions/33-Correlation-LaTeX.Rmd'}} -->
<!-- ``` -->


<!-- <!-- Define colours as appropriate --> -->
<!-- ```{r, child = if (knitr::is_html_output()) {'./children/coloursHTML.Rmd'} else {'./children/coloursLaTeX.Rmd'}} -->
<!-- ``` -->


## Introduction: red deer {#Chap33-Intro}
\index{Correlation}

So far, RQs about single variables (descriptive\ RQs) and RQs for comparisons (relational and repeated-measures\ RQs) have been studied.
In this chapter and the next, the relationship between two quantitative variables is studied (correlational\ RQs) *when that relationship is approximately linear*.

Consider the age and the weight of the molars of $n = 78$ male red-deer [@data:Holgate1965:StraightLine], as seen in Chap.\ \@ref(TwoQuant)
`r if( knitr::is_latex_output() ) {
  '(and Table\\ \\@ref(tab:RedDeerData)).'
} else {
  '(and the data in that section).'
}`
The data comprises two quantitative variables, and the scatterplot is repeated in Fig.\ \@ref(fig:RedDeerScatter2).\index{Graphs!scatterplot}

```{r RedDeerScatter2, fig.width=5.25, out.width='60%', fig.align='center', fig.height=3.75, fig.cap="Molar weight verses age for the red-deer data."}
data(RedDeer)

plot(Weight ~ Age, 
     data = RedDeer,
     las = 1,
     pch = 19, 
     ylim = c(0, 5.5),
     xlim = c(4, 15),
     cex = 0.8,
     main = "Molar weight and age\nof male red deer",
     xlab = "Age (in years)",
     ylab = "Molar weight (in g)")
```


Knowing the age of the deer seems to provide some information about the weight of the molars; that is, a relationship between the variables seems evident.
Furthermore, the relationship seems somewhat *linear*, and in Sect.\ \@ref(CorrCoefficients) the *correlation coefficient*\index{Correlation coefficient (Pearson)} was found to be $r = -0.584$.


::: {.importantBox .important data-latex="{iconmonstr-warning-8-240.png}"}
Recall that the *sample* correlation coefficient is denoted by\ $r$, and the *population* correlation coefficient is denoted by\ $\rho$,
:::


Only one of the countless possible samples of deer have been studied, and the value of\ $r$ (an estimate of $\rho$, the *parameter*) will vary from sample to sample.
That is, the value of\ $r$ has a sampling distribution, and sampling variation exists.\index{Sampling variation}
The sampling distribution of\ $r$, however, does *not* have a normal distribution, so CIs for $\rho$ will not be discussed (indeed, software does not always provide a CI for $\rho$).


<div style="float:right; width: 222x; border: 1px; padding:10px">
<img src="Illustrations/diana-parkhouse-Qf4eZXC3t2Y-unsplash.jpg" width="200px"/>
</div>



## Hypothesis test for $\rho$ {#CorrelationTesting}
\index{Hypothesis testing!correlation coefficient}

A correlational RQ can be asked about the relationship between the variables in the *population*, as measured by the unknown *population* (Pearson) correlation coefficient:\index{Correlation}

> In the population, is there a linear relationship between the value of\ $y$ and the value of\ $x$?

In the context of the red-deer data, the RQ is:

> In male red deer, is there a linear relationship between molar weight and age?

This is a two-tailed RQ.\spacex
More realistically, a *one-tailed* research question could be asked, since it seems reasonable that teeth get lighter (worn down) as deer age:

> In male red deer, does molar weight *decrease* linearly as age increases?

This is a *one-tailed* RQ, about the population parameter $\rho$.
Clearly, the *sample* correlation coefficient $r$ for the red-deer data is not zero, and the RQ is effectively asking if sampling variation is the reason for this discrepancy.
The null hypothesis is:

* $H_0$: $\rho = 0$.

The parameter is $\rho$, the *population* correlation coefficient.
This null hypothesis is the 'no relationship' position, which proposes that the population correlation coefficient is zero, and the sample correlation coefficient is not zero due to sampling variation.
The alternative hypothesis is:

* $H_1$:  $\rho < 0$ \quad (*one-tailed* test, based on the RQ).

As usual, initially *assume* that $\rho = 0$ (from\ $H_0$), then describe what values of\ $r$ could be *expected* using the *sampling distribution*, under that assumption, across all possible samples (sampling variation).
Then the *observed* value of\ $r$ is compared to the expected values to determine if the value of\ $r$ supports or contradicts the assumption.

For a correlation coefficient, the sampling distribution of\ $r$ does not have a normal distribution^[For those interested: the value of\ $r$ only varies between $-1$ and $1$, so cannot have a normal distribution. A transformation of\ $r$ *does* exist that has an approximate normal distribution and *standard error*.], and software output usually does not provide a standard error, so we will not discuss CIs for the correlation coefficient.

However, the output (Fig.\ \@ref(fig:RedDeerCorrelationjamovi2))\index{Software output!correlation} contains the relevant $P$-value for the $t$-test.
The *two*-tailed $P$-value for the test is less than\ $0.001$, so the *one*-tailed $P$-value will be less than $0.001/2 = 0.0005$.
*Very strong evidence* exists to support\ $H_1$ (that the correlation in the population is less than zero).
We write:

> The sample presents very strong evidence (one-tailed $P < 0.0005$) that the molar weight decreases as the age of the male red deer increases ($r = -0.584$; $n = 78$) in the population.

Notice the three features of writing conclusions again:
An *answer to the RQ*; evidence to support the conclusion ('one-tailed $P < 0.0005$'; here no value for the test statistic is given in the output); and some *sample summary information* ('$r = -0.584$; $n = 78$').




```{r RedDeerCorrelationjamovi2, fig.cap="Software output for the red-deer data.", fig.align="center", out.width='45%'}
knitr::include_graphics("jamovi/RedDeer/RedDeer-Correlation.png")
```


::: {.tipBox .tip data-latex="{iconmonstr-info-6-240.png}"}
The evidence suggests that the correlation coefficient is *not zero* (in the population).
However, a *non-zero* correlation doesn't necessarily mean a *strong* correlation exists.
The correlation may be weak in the population (as estimated by the value of\ $r$), but evidence exists that the correlation is *not zero* in the *population*.

That is, the test is about statistical significance, not practical importance.\index{Practical importance}
:::


## Statistical validity conditions {#ValidityCorrelation}
\index{Statistical validity (for inference)!correlation coefficient}

As usual, these results hold under certain conditions.
The conditions for which the test is statistically valid are:

1. The relationship is approximately linear (necessary for the correlation coefficient to be appropriate).
1. The variation in the response variable is approximately constant for all values of the explanatory variable.
1. The sample size is at least\ $25$.

The sample size of\ $25$ is a rough figure; some books give other values.
The units of analysis are also assumed to be *independent* (e.g., from a simple random sample).

If the statistical validity conditions are not met, but the relationship is only increasing or only decreasing, other similar options include using a Spearman\index{Correlation coefficient!Spearman} or Kendall correlation coefficient\index{Correlation coefficient!Kendall} [@conover2003practical] or using resampling methods [@efron2021computer].



::: {.example #StatisticalValidityDeer name="Statistical validity"}
For the red-deer data, the scatterplot (Fig.\ \@ref(fig:RedDeerScatter2)) shows that the relationship is approximately linear, so using a (Pearson) correlation coefficient is appropriate.
For the hypothesis test, the variation in molar weights doesn't seem to be obviously getting larger or smaller for older deer, and the sample size is also greater than\ $25$.
The test in Sect.\ \@ref(CorrelationTesting) is statistically valid.
:::


<iframe src="https://learningapps.org/watch?v=pd07ft8ec22" style="border:0px;width:100%;height:500px" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe>



## Example: removal efficiency {#Removal-Efficiency}


<div style="float:right; width: 222x; border: 1px; padding:10px">
<img src="Illustrations/pexels-lisa-fotios-3264779.jpg" width="200px"/>
</div>


[*Dataset*: `Removal`]
In wastewater treatment facilities, air from biofiltration is passed through a membrane and dissolved in water, and is transformed into harmless by-products.
The removal efficiency\ $y$ (in\ %) may depend on the inlet temperature (in\ $^\circ$C; $x$).
@chitwood2001treatment asked:

> In treating biofiltration wastewater, is the removal efficiency linearly associated with the inlet temperature?

The scatterplot of the $n = 32$ observations was shown (and described) in Sect.\ \@ref(ScatterplotsRemoval-Efficiency), and repeated here (Fig.\ \@ref(fig:CorrelationRemovalEfficiency), left panel); the relationship is approximately linear.

The output (Fig.\ \@ref(fig:CorrelationRemovalEfficiency), right panel) shows that the sample correlation coefficient is $r = 0.891$, and so $R^2 = (0.891)^2 = 79.4$%.\index{R@$R^2$}
This means that the unexplained variation in removal efficiency reduces by about\ $79.4$% by knowing the inlet temperature.


```{r CorrelationRemovalEfficiency, fig.cap="The relationship between removal efficiency and inlet temperature. Left: scatterplot. Right: software output.", fig.align="center", fig.width=5, fig.height=3.25, out.width=c("52%", "5%", "38%"), fig.show="hold"}
data(Removal)

plot(Removal ~ Temp, 
     data = Removal,
     main = "Removal efficiency",
     xlab = "Temperature (degrees C)",
     ylab = "Removal efficiency (%)",
     pch = 19,
     ylim = c(97.5, 99.0),
     xlim = c(5, 18),
     las = 1
     )
knitr::include_graphics("OtherImages/SPACER.png")
knitr::include_graphics("jamovi/Removal/RemovalCorrelation.png")
```


As always, the RQ is about the parameter, the correlation between the removal efficiency and inlet temperature in the population $\rho$.
To test if a linear relationship exists in the population, write:
$$
   \text{$H_0$: } \rho = 0\quad\text{and}\quad \text{$H_1$: } \rho \ne 0,
$$
where $\rho$ is the population correlation coefficient.
The alternative hypothesis is two-tailed (as implied by the RQ).
The software output (Fig.\ \@ref(fig:CorrelationRemovalEfficiency), right panel) shows that $P < 0.001$.
We conclude:

> The sample presents very strong evidence (two-tailed $P < 0.001$) that removal efficiency depends on the inlet temperature ($r = 0.891$; $n = 32$) in the population.

The relationship is approximately linear, there is no obvious non-constant variation in the removal efficiency, and the sample size is larger than\ $25$, so the hypothesis test result is statistically valid.


